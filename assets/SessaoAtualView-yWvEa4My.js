import{d as H,s as g,r as P,w as B,a as W,c as r,o as n,b as s,t as y,e as j,f as a,v as V,F as E,g as U,h as K,i as M,j as L,_ as Q,u as X,k as Y,l as Z,m as T,n as D,p as z,q as ss}from"./index-DTJB6UjR.js";const es=H("sessions",{state:()=>({sessions:[],activeSession:null,loading:!1,error:null}),actions:{async fetchSessions(o){if(this.loading=!0,this.error=null,!o){this.sessions=[],this.loading=!1;return}try{const{data:e,error:b}=await g.from("sessions").select("*").eq("campaign_id",o).order("created_at",{ascending:!1});if(b)throw b;this.sessions=e}catch(e){this.error=e.message}finally{this.loading=!1}},async fetchLatestSessionWithDetails(o){if(this.loading=!0,this.error=null,this.activeSession=null,!o){this.loading=!1;return}try{const{data:e,error:b}=await g.from("sessions").select(`
            *,
            session_encontros_desafios(*),
            session_ganchos_personagens(*),
            session_locais_interessantes(*, session_locais_caracteristicas(*)),
            session_npcs_importantes(*, npcs(id, name, concept, image)),
            session_objetivos(*),
            session_segredos_rumores(*),
            session_tesouros_recompensas(*)
          `).eq("campaign_id",o).order("created_at",{ascending:!1}).limit(1).single();if(b)if(b.code==="PGRST116")this.activeSession=null;else throw b;else this.activeSession=e}catch(e){this.error=e.message,console.error("Erro ao buscar sessão mais recente:",e)}finally{this.loading=!1}},async addSession(o){this.loading=!0,this.error=null;try{const{title:e,description:b,comeco_forte:C,gancho_proxima_aventura:i,campaign_id:N}=o,{data:O,error:k}=await g.from("sessions").insert({title:e,description:b,comeco_forte:C,gancho_proxima_aventura:i,campaign_id:N}).select().single();if(k)throw k;const x=O.id,$=[];if(o.session_objetivos&&o.session_objetivos.length>0&&$.push(g.from("session_objetivos").insert(o.session_objetivos.map(_=>({..._,session_id:x})))),o.session_ganchos_personagens&&o.session_ganchos_personagens.length>0&&$.push(g.from("session_ganchos_personagens").insert(o.session_ganchos_personagens.map(_=>({..._,session_id:x})))),o.session_locais_interessantes&&o.session_locais_interessantes.length>0)for(const _ of o.session_locais_interessantes){const{data:q,error:h}=await g.from("session_locais_interessantes").insert({name:_.name,session_id:x}).select().single();if(h)throw h;_.session_locais_caracteristicas&&_.session_locais_caracteristicas.length>0&&$.push(g.from("session_locais_caracteristicas").insert(_.session_locais_caracteristicas.map(v=>({...v,local_id:q.id}))))}o.session_npcs_importantes&&o.session_npcs_importantes.length>0&&$.push(g.from("session_npcs_importantes").insert(o.session_npcs_importantes.map(_=>({..._,session_id:x})))),o.session_encontros_desafios&&o.session_encontros_desafios.length>0&&$.push(g.from("session_encontros_desafios").insert(o.session_encontros_desafios.map(_=>({..._,session_id:x})))),o.session_segredos_rumores&&o.session_segredos_rumores.length>0&&$.push(g.from("session_segredos_rumores").insert(o.session_segredos_rumores.map(_=>({..._,session_id:x})))),o.session_tesouros_recompensas&&o.session_tesouros_recompensas.length>0&&$.push(g.from("session_tesouros_recompensas").insert(o.session_tesouros_recompensas.map(_=>({..._,session_id:x})))),await Promise.all($),this.sessions.unshift(O)}catch(e){this.error=e.message}finally{this.loading=!1}},async updateSession(o){this.loading=!0,this.error=null;try{const{id:e,title:b,description:C,comeco_forte:i,gancho_proxima_aventura:N,campaign_id:O}=o,{data:k,error:x}=await g.from("sessions").update({title:b,description:C,comeco_forte:i,gancho_proxima_aventura:N}).eq("id",e).select().single();if(x)throw x;const $=[g.from("session_objetivos").delete().eq("session_id",e),g.from("session_ganchos_personagens").delete().eq("session_id",e),g.from("session_locais_interessantes").delete().eq("session_id",e),g.from("session_npcs_importantes").delete().eq("session_id",e),g.from("session_encontros_desafios").delete().eq("session_id",e),g.from("session_segredos_rumores").delete().eq("session_id",e),g.from("session_tesouros_recompensas").delete().eq("session_id",e)];await Promise.all($);const _=[];if(o.session_objetivos&&o.session_objetivos.length>0&&_.push(g.from("session_objetivos").insert(o.session_objetivos.map(h=>({...h,session_id:e})))),o.session_ganchos_personagens&&o.session_ganchos_personagens.length>0&&_.push(g.from("session_ganchos_personagens").insert(o.session_ganchos_personagens.map(h=>({...h,session_id:e})))),o.session_locais_interessantes&&o.session_locais_interessantes.length>0)for(const h of o.session_locais_interessantes){const{data:v,error:m}=await g.from("session_locais_interessantes").insert({name:h.name,session_id:e}).select().single();if(m)throw m;h.session_locais_caracteristicas&&h.session_locais_caracteristicas.length>0&&_.push(g.from("session_locais_caracteristicas").insert(h.session_locais_caracteristicas.map(w=>({...w,local_id:v.id}))))}o.session_npcs_importantes&&o.session_npcs_importantes.length>0&&_.push(g.from("session_npcs_importantes").insert(o.session_npcs_importantes.map(h=>({...h,session_id:e})))),o.session_encontros_desafios&&o.session_encontros_desafios.length>0&&_.push(g.from("session_encontros_desafios").insert(o.session_encontros_desafios.map(h=>({...h,session_id:e})))),o.session_segredos_rumores&&o.session_segredos_rumores.length>0&&_.push(g.from("session_segredos_rumores").insert(o.session_segredos_rumores.map(h=>({...h,session_id:e})))),o.session_tesouros_recompensas&&o.session_tesouros_recompensas.length>0&&_.push(g.from("session_tesouros_recompensas").insert(o.session_tesouros_recompensas.map(h=>({...h,session_id:e})))),await Promise.all(_);const q=this.sessions.findIndex(h=>h.id===e);q!==-1&&(this.sessions[q]=k),this.activeSession&&this.activeSession.id}catch(e){this.error=e.message}finally{this.loading=!1}},async deleteSession(o,e){this.loading=!0,this.error=null;try{const{error:b}=await g.from("sessions").delete().eq("id",o);if(b)throw b;this.sessions=this.sessions.filter(C=>C.id!==o),this.activeSession&&this.activeSession.id}catch(b){this.error=b.message}finally{this.loading=!1}}}}),ts={class:"p-4 bg-white dark:bg-slate-800 rounded-lg shadow-md h-full flex flex-col"},os={class:"text-2xl font-bold text-amber-700 dark:text-amber-500 mb-4"},ns={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},as={class:"mb-4 relative"},rs={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},is={class:"mb-4 relative"},ls={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},ds={class:"mb-4 relative"},cs={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},us={class:"mb-4 relative"},ms={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},fs={class:"mt-6 p-4 border rounded-lg shadow-sm bg-slate-50 dark:bg-slate-700 border-gray-300 dark:border-slate-600"},ps={class:"text-lg font-bold mb-3 text-slate-800 dark:text-slate-100 flex items-center gap-x-2"},gs={class:"relative"},_s=["for"],bs={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},hs=["id","onUpdate:modelValue"],xs={class:"md:col-span-2 relative"},vs=["for"],ks={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},ys=["id","onUpdate:modelValue"],ws=["onClick"],$s={class:"mt-6 p-4 border rounded-lg shadow-sm bg-slate-50 dark:bg-slate-700 border-gray-300 dark:border-slate-600"},Ss={class:"text-lg font-bold mb-3 text-slate-800 dark:text-slate-100 flex items-center gap-x-2"},Cs={class:"relative"},Ns=["for"],js={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},Vs=["id","onUpdate:modelValue"],Es={class:"md:col-span-2 relative"},Us=["for"],Os={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},qs=["id","onUpdate:modelValue"],Ps=["onClick"],Ts={class:"mt-6 p-4 border rounded-lg shadow-sm bg-slate-50 dark:bg-slate-700 border-gray-300 dark:border-slate-600"},As={class:"text-lg font-bold mb-3 text-slate-800 dark:text-slate-100 flex items-center gap-x-2"},Rs={class:"flex justify-between items-center mb-2 relative"},Ls=["for"],Js={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},Gs=["id","onUpdate:modelValue"],Ms=["onClick"],Fs={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},Bs=["id","onUpdate:modelValue"],Is=["onClick"],zs=["onClick"],Ws={class:"mt-6 p-4 border rounded-lg shadow-sm bg-slate-50 dark:bg-slate-700 border-gray-300 dark:border-slate-600"},Hs={class:"text-lg font-bold mb-3 text-slate-800 dark:text-slate-100 flex items-center gap-x-2"},Ks={class:"relative"},Qs=["for"],Xs={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},Ys=["id","onUpdate:modelValue"],Zs=["onClick"],Ds={class:"mt-6 p-4 border rounded-lg shadow-sm bg-slate-50 dark:bg-slate-700 border-gray-300 dark:border-slate-600"},se={class:"text-lg font-bold mb-3 text-slate-800 dark:text-slate-100 flex items-center gap-x-2"},ee={class:"relative"},te=["for"],oe={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},ne=["id","onUpdate:modelValue"],ae={class:"relative"},re=["for"],ie={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},le=["id","onUpdate:modelValue"],de={class:"relative"},ce=["for"],ue={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},me=["id","onUpdate:modelValue"],fe=["onClick"],pe={class:"mt-6 p-4 border rounded-lg shadow-sm bg-slate-50 dark:bg-slate-700 border-gray-300 dark:border-slate-600"},ge={class:"text-lg font-bold mb-3 text-slate-800 dark:text-slate-100 flex items-center gap-x-2"},_e={class:"relative"},be=["for"],he={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},xe=["id","onUpdate:modelValue"],ve=["onClick"],ke={class:"mt-6 p-4 border rounded-lg shadow-sm bg-slate-50 dark:bg-slate-700 border-gray-300 dark:border-slate-600"},ye={class:"text-lg font-bold mb-3 text-slate-800 dark:text-slate-100 flex items-center gap-x-2"},we={class:"relative"},$e=["for"],Se={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},Ce=["id","onUpdate:modelValue"],Ne={class:"md:col-span-2"},je=["for"],Ve={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none mt-6"},Ee=["id","onUpdate:modelValue"],Ue=["onClick"],Oe={class:"flex justify-end space-x-2 mt-6"},qe={type:"submit",class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 flex items-center gap-x-2"},Pe={__name:"SessionForm",props:{session:{type:Object,default:null},campaignId:{type:Number,required:!0}},emits:["save","close"],setup(o,{emit:e}){const b=o,C=e,i=P({title:"",description:"",comeco_forte:"",gancho_proxima_aventura:"",session_objetivos:[],session_ganchos_personagens:[],session_locais_interessantes:[],session_npcs_importantes:[],session_encontros_desafios:[],session_segredos_rumores:[],session_tesouros_recompensas:[]});B(()=>b.session,f=>{f?i.value={...f,session_objetivos:f.session_objetivos?JSON.parse(JSON.stringify(f.session_objetivos)):[],session_ganchos_personagens:f.session_ganchos_personagens?JSON.parse(JSON.stringify(f.session_ganchos_personagens)):[],session_locais_interessantes:f.session_locais_interessantes?f.session_locais_interessantes.map(t=>({...t,session_locais_caracteristicas:t.session_locais_caracteristicas?JSON.parse(JSON.stringify(t.session_locais_caracteristicas)):[]})):[],session_npcs_importantes:f.session_npcs_importantes?JSON.parse(JSON.stringify(f.session_npcs_importantes)):[],session_encontros_desafios:f.session_encontros_desafios?JSON.parse(JSON.stringify(f.session_encontros_desafios)):[],session_segredos_rumores:f.session_segredos_rumores?JSON.parse(JSON.stringify(f.session_segredos_rumores)):[],session_tesouros_recompensas:f.session_tesouros_recompensas?JSON.parse(JSON.stringify(f.session_tesouros_recompensas)):[]}:i.value={title:"",description:"",comeco_forte:"",gancho_proxima_aventura:"",session_objetivos:[],session_ganchos_personagens:[],session_locais_interessantes:[],session_npcs_importantes:[],session_encontros_desafios:[],session_segredos_rumores:[],session_tesouros_recompensas:[]}},{immediate:!0});const N=()=>{i.value.session_objetivos.push({type:"",description:""})},O=f=>{i.value.session_objetivos.splice(f,1)},k=()=>{i.value.session_ganchos_personagens.push({personagem_name:"",description:""})},x=f=>{i.value.session_ganchos_personagens.splice(f,1)},$=()=>{i.value.session_locais_interessantes.push({name:"",session_locais_caracteristicas:[]})},_=f=>{i.value.session_locais_interessantes.splice(f,1)},q=f=>{i.value.session_locais_interessantes[f].session_locais_caracteristicas.push({description:""})},h=(f,t)=>{i.value.session_locais_interessantes[f].session_locais_caracteristicas.splice(t,1)},v=()=>{i.value.session_npcs_importantes.push({npc_id:null})},m=f=>{i.value.session_npcs_importantes.splice(f,1)},w=()=>{i.value.session_encontros_desafios.push({title:"",description:"",mecanica:""})},d=f=>{i.value.session_encontros_desafios.splice(f,1)},S=()=>{i.value.session_segredos_rumores.push({description:""})},A=f=>{i.value.session_segredos_rumores.splice(f,1)},J=()=>{i.value.session_tesouros_recompensas.push({name:"",description_mecanica:""})},F=f=>{i.value.session_tesouros_recompensas.splice(f,1)},G=()=>{C("save",{...i.value,campaign_id:b.campaignId})};return(f,t)=>{const c=W("font-awesome-icon");return n(),r("div",ts,[s("h2",os,y(o.session?.id?"Editar Sessão":"Nova Sessão"),1),s("form",{onSubmit:K(G,["prevent"]),class:"flex flex-col flex-grow overflow-y-auto"},[s("div",ns,[s("div",as,[t[5]||(t[5]=s("label",{for:"title",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Título",-1)),s("div",rs,[a(c,{icon:["fas","heading"],class:"text-gray-400"})]),j(s("input",{type:"text",id:"title","onUpdate:modelValue":t[0]||(t[0]=u=>i.value.title=u),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-700 dark:border-slate-600 dark:text-white pl-10",required:""},null,512),[[V,i.value.title]])]),s("div",is,[t[6]||(t[6]=s("label",{for:"description",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Descrição",-1)),s("div",ls,[a(c,{icon:["fas","align-left"],class:"text-gray-400"})]),j(s("textarea",{id:"description","onUpdate:modelValue":t[1]||(t[1]=u=>i.value.description=u),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-700 dark:border-slate-600 dark:text-white pl-10"},null,512),[[V,i.value.description]])]),s("div",ds,[t[7]||(t[7]=s("label",{for:"comeco_forte",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Começo Forte",-1)),s("div",cs,[a(c,{icon:["fas","bolt"],class:"text-gray-400"})]),j(s("textarea",{id:"comeco_forte","onUpdate:modelValue":t[2]||(t[2]=u=>i.value.comeco_forte=u),rows:"2",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-700 dark:border-slate-600 dark:text-white pl-10"},null,512),[[V,i.value.comeco_forte]])]),s("div",us,[t[8]||(t[8]=s("label",{for:"gancho_proxima_aventura",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Gancho Próxima Aventura",-1)),s("div",ms,[a(c,{icon:["fas","arrow-right"],class:"text-gray-400"})]),j(s("textarea",{id:"gancho_proxima_aventura","onUpdate:modelValue":t[3]||(t[3]=u=>i.value.gancho_proxima_aventura=u),rows:"2",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-700 dark:border-slate-600 dark:text-white pl-10"},null,512),[[V,i.value.gancho_proxima_aventura]])])]),s("div",fs,[s("h3",ps,[a(c,{icon:["fas","bullseye"]}),t[9]||(t[9]=s("span",null,"Objetivos",-1))]),(n(!0),r(E,null,U(i.value.session_objetivos,(u,l)=>(n(),r("div",{key:l,class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-3 items-end p-3 border rounded-lg bg-white dark:bg-slate-800"},[s("div",gs,[s("label",{for:`objetivo-type-${l}`,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Tipo:",8,_s),s("div",bs,[a(c,{icon:["fas","tag"],class:"text-gray-400"})]),j(s("input",{type:"text",id:`objetivo-type-${l}`,"onUpdate:modelValue":p=>u.type=p,class:"h-10 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-600 dark:border-slate-500 dark:text-white pl-10"},null,8,hs),[[V,u.type]])]),s("div",xs,[s("label",{for:`objetivo-description-${l}`,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Descrição:",8,vs),s("div",ks,[a(c,{icon:["fas","align-left"],class:"text-gray-400"})]),j(s("textarea",{id:`objetivo-description-${l}`,"onUpdate:modelValue":p=>u.description=p,rows:"1",class:"h-10 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-600 dark:border-slate-500 dark:text-white pl-10"},null,8,ys),[[V,u.description]])]),s("button",{type:"button",onClick:p=>O(l),class:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline flex items-center justify-center gap-x-2"},[a(c,{icon:["fas","trash"]}),t[10]||(t[10]=s("span",null,"Remover",-1))],8,ws)]))),128)),s("button",{type:"button",onClick:N,class:"mt-2 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 flex items-center justify-center gap-x-2"},[a(c,{icon:["fas","plus"]}),t[11]||(t[11]=s("span",null,"Adicionar Objetivo",-1))])]),s("div",$s,[s("h3",Ss,[a(c,{icon:["fas","user-tag"]}),t[12]||(t[12]=s("span",null,"Ganchos de Personagens",-1))]),(n(!0),r(E,null,U(i.value.session_ganchos_personagens,(u,l)=>(n(),r("div",{key:l,class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-3 items-end p-3 border rounded-lg bg-white dark:bg-slate-800"},[s("div",Cs,[s("label",{for:`gancho-personagem-${l}`,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Nome do Personagem:",8,Ns),s("div",js,[a(c,{icon:["fas","user"],class:"text-gray-400"})]),j(s("input",{type:"text",id:`gancho-personagem-${l}`,"onUpdate:modelValue":p=>u.personagem_name=p,class:"h-10 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-600 dark:border-slate-500 dark:text-white pl-10"},null,8,Vs),[[V,u.personagem_name]])]),s("div",Es,[s("label",{for:`gancho-description-${l}`,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Descrição:",8,Us),s("div",Os,[a(c,{icon:["fas","align-left"],class:"text-gray-400"})]),j(s("textarea",{id:`gancho-description-${l}`,"onUpdate:modelValue":p=>u.description=p,rows:"1",class:"h-10 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-600 dark:border-slate-500 dark:text-white pl-10"},null,8,qs),[[V,u.description]])]),s("button",{type:"button",onClick:p=>x(l),class:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline flex items-center justify-center gap-x-2"},[a(c,{icon:["fas","trash"]}),t[13]||(t[13]=s("span",null,"Remover",-1))],8,Ps)]))),128)),s("button",{type:"button",onClick:k,class:"mt-2 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 flex items-center gap-x-2"},[a(c,{icon:["fas","plus"]}),t[14]||(t[14]=s("span",null,"Adicionar Gancho",-1))])]),s("div",Ts,[s("h3",As,[a(c,{icon:["fas","map-marker-alt"]}),t[15]||(t[15]=s("span",null,"Locais Interessantes",-1))]),(n(!0),r(E,null,U(i.value.session_locais_interessantes,(u,l)=>(n(),r("div",{key:l,class:"mb-4 p-3 border rounded-lg bg-white dark:bg-slate-800"},[s("div",Rs,[s("label",{for:`local-name-${l}`,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Nome do Local:",8,Ls),s("div",Js,[a(c,{icon:["fas","map-pin"],class:"text-gray-400"})]),j(s("input",{type:"text",id:`local-name-${l}`,"onUpdate:modelValue":p=>u.name=p,class:"h-10 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-600 dark:border-slate-500 dark:text-white pl-10"},null,8,Gs),[[V,u.name]]),s("button",{type:"button",onClick:p=>_(l),class:"bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline text-sm flex items-center justify-center gap-x-1"},[a(c,{icon:["fas","trash"]}),t[16]||(t[16]=s("span",null,"Remover Local",-1))],8,Ms)]),t[19]||(t[19]=s("h4",{class:"text-md font-semibold mb-2 text-slate-700 dark:text-slate-200"},"Características:",-1)),(n(!0),r(E,null,U(u.session_locais_caracteristicas,(p,R)=>(n(),r("div",{key:R,class:"flex gap-4 mb-2 items-end relative"},[s("div",Fs,[a(c,{icon:["fas","info-circle"],class:"text-gray-400"})]),j(s("textarea",{id:`carac-description-${l}-${R}`,"onUpdate:modelValue":I=>p.description=I,rows:"1",class:"h-10 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-600 dark:border-slate-500 dark:text-white pl-10"},null,8,Bs),[[V,p.description]]),s("button",{type:"button",onClick:I=>h(l,R),class:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline flex items-center justify-center gap-x-2"},[a(c,{icon:["fas","trash"]}),t[17]||(t[17]=s("span",null,"Remover",-1))],8,Is)]))),128)),s("button",{type:"button",onClick:p=>q(l),class:"mt-2 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 flex items-center gap-x-2"},[a(c,{icon:["fas","plus"]}),t[18]||(t[18]=s("span",null,"Adicionar Característica",-1))],8,zs)]))),128)),s("button",{type:"button",onClick:$,class:"mt-2 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 flex items-center gap-x-2"},[a(c,{icon:["fas","plus"]}),t[20]||(t[20]=s("span",null,"Adicionar Local",-1))])]),s("div",Ws,[s("h3",Hs,[a(c,{icon:["fas","user-friends"]}),t[21]||(t[21]=s("span",null,"NPCs Importantes",-1))]),(n(!0),r(E,null,U(i.value.session_npcs_importantes,(u,l)=>(n(),r("div",{key:l,class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-3 items-end p-3 border rounded-lg bg-white dark:bg-slate-800"},[s("div",Ks,[s("label",{for:`npc-id-${l}`,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"ID do NPC:",8,Qs),s("div",Xs,[a(c,{icon:["fas","id-badge"],class:"text-gray-400"})]),j(s("input",{type:"number",id:`npc-id-${l}`,"onUpdate:modelValue":p=>u.npc_id=p,class:"h-10 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-600 dark:border-slate-500 dark:text-white pl-10"},null,8,Ys),[[V,u.npc_id]])]),s("button",{type:"button",onClick:p=>m(l),class:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline flex items-center justify-center gap-x-2"},[a(c,{icon:["fas","trash"]}),t[22]||(t[22]=s("span",null,"Remover",-1))],8,Zs)]))),128)),s("button",{type:"button",onClick:v,class:"mt-2 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 flex items-center gap-x-2"},[a(c,{icon:["fas","plus"]}),t[23]||(t[23]=s("span",null,"Adicionar NPC",-1))])]),s("div",Ds,[s("h3",se,[a(c,{icon:["fas","dragon"]}),t[24]||(t[24]=s("span",null,"Encontros e Desafios",-1))]),(n(!0),r(E,null,U(i.value.session_encontros_desafios,(u,l)=>(n(),r("div",{key:l,class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-3 items-end p-3 border rounded-lg bg-white dark:bg-slate-800"},[s("div",ee,[s("label",{for:`encontro-title-${l}`,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Título:",8,te),s("div",oe,[a(c,{icon:["fas","heading"],class:"text-gray-400"})]),j(s("input",{type:"text",id:`encontro-title-${l}`,"onUpdate:modelValue":p=>u.title=p,class:"h-10 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-600 dark:border-slate-500 dark:text-white pl-10"},null,8,ne),[[V,u.title]])]),s("div",ae,[s("label",{for:`encontro-description-${l}`,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Descrição:",8,re),s("div",ie,[a(c,{icon:["fas","align-left"],class:"text-gray-400"})]),j(s("textarea",{id:`encontro-description-${l}`,"onUpdate:modelValue":p=>u.description=p,rows:"1",class:"h-10 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-600 dark:border-slate-500 dark:text-white pl-10"},null,8,le),[[V,u.description]])]),s("div",de,[s("label",{for:`encontro-mecanica-${l}`,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Mecânica:",8,ce),s("div",ue,[a(c,{icon:["fas","cogs"],class:"text-gray-400"})]),j(s("input",{type:"text",id:`encontro-mecanica-${l}`,"onUpdate:modelValue":p=>u.mecanica=p,class:"h-10 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-600 dark:border-slate-500 dark:text-white pl-10"},null,8,me),[[V,u.mecanica]])]),s("button",{type:"button",onClick:p=>d(l),class:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline flex items-center justify-center gap-x-2"},[a(c,{icon:["fas","trash"]}),t[25]||(t[25]=s("span",null,"Remover",-1))],8,fe)]))),128)),s("button",{type:"button",onClick:w,class:"mt-2 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 flex items-center gap-x-2"},[a(c,{icon:["fas","plus"]}),t[26]||(t[26]=s("span",null,"Adicionar Encontro",-1))])]),s("div",pe,[s("h3",ge,[a(c,{icon:["fas","mask"]}),t[27]||(t[27]=s("span",null,"Segredos e Rumores",-1))]),(n(!0),r(E,null,U(i.value.session_segredos_rumores,(u,l)=>(n(),r("div",{key:l,class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-3 items-end p-3 border rounded-lg bg-white dark:bg-slate-800"},[s("div",_e,[s("label",{for:`segredo-description-${l}`,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Descrição:",8,be),s("div",he,[a(c,{icon:["fas","align-left"],class:"text-gray-400"})]),j(s("textarea",{id:`segredo-description-${l}`,"onUpdate:modelValue":p=>u.description=p,rows:"1",class:"h-10 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-600 dark:border-slate-500 dark:text-white pl-10"},null,8,xe),[[V,u.description]])]),s("button",{type:"button",onClick:p=>A(l),class:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline flex items-center justify-center gap-x-2"},[a(c,{icon:["fas","trash"]}),t[28]||(t[28]=s("span",null,"Remover",-1))],8,ve)]))),128)),s("button",{type:"button",onClick:S,class:"mt-2 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 flex items-center gap-x-2"},[a(c,{icon:["fas","plus"]}),t[29]||(t[29]=s("span",null,"Adicionar Segredo",-1))])]),s("div",ke,[s("h3",ye,[a(c,{icon:["fas","coins"]}),t[30]||(t[30]=s("span",null,"Tesouros e Recompensas",-1))]),(n(!0),r(E,null,U(i.value.session_tesouros_recompensas,(u,l)=>(n(),r("div",{key:l,class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-3 items-end p-3 border rounded-lg bg-white dark:bg-slate-800"},[s("div",we,[s("label",{for:`tesouro-name-${l}`,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Nome:",8,$e),s("div",Se,[a(c,{icon:["fas","gem"],class:"text-gray-400"})]),j(s("input",{type:"text",id:`tesouro-name-${l}`,"onUpdate:modelValue":p=>u.name=p,class:"h-10 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-600 dark:border-slate-500 dark:text-white pl-10"},null,8,Ce),[[V,u.name]])]),s("div",Ne,[s("label",{for:`tesouro-description-${l}`,class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Descrição Mecânica:",8,je),s("div",Ve,[a(c,{icon:["fas","scroll"],class:"text-gray-400"})]),j(s("textarea",{id:`tesouro-description-${l}`,"onUpdate:modelValue":p=>u.description_mecanica=p,rows:"1",class:"h-10 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 dark:bg-slate-600 dark:border-slate-500 dark:text-white pl-10"},null,8,Ee),[[V,u.description_mecanica]])]),s("button",{type:"button",onClick:p=>F(l),class:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline flex items-center justify-center gap-x-2"},[a(c,{icon:["fas","trash"]}),t[31]||(t[31]=s("span",null,"Remover",-1))],8,Ue)]))),128)),s("button",{type:"button",onClick:J,class:"mt-2 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 flex items-center gap-x-2"},[a(c,{icon:["fas","plus"]}),t[32]||(t[32]=s("span",null,"Adicionar Tesouro",-1))])]),s("div",Oe,[s("button",{type:"button",onClick:t[4]||(t[4]=u=>C("close")),class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 dark:bg-slate-600 dark:border-slate-500 dark:text-white dark:hover:bg-slate-500 flex items-center gap-x-2"},[a(c,{icon:["fas","times"]}),t[33]||(t[33]=s("span",null,"Cancelar",-1))]),s("button",qe,[a(c,{icon:["fas","save"]}),t[34]||(t[34]=s("span",null,"Salvar",-1))])])],32)])}}},Te={class:"md:col-span-2 bg-white dark:bg-slate-800 p-6 rounded-lg shadow min-h-[400px]"},Ae={key:0,class:"text-center text-slate-500 dark:text-slate-400 flex items-center justify-center h-full"},Re={key:1,class:"h-full flex flex-col"},Le={class:"text-2xl font-bold text-amber-700 dark:text-amber-500 mb-2"},Je={class:"text-sm text-slate-600 dark:text-slate-400 mb-4"},Ge={key:0},Me={class:"grid grid-cols-1 gap-4 flex-grow overflow-y-auto"},Fe={class:"bg-slate-50 dark:bg-slate-700 p-4 rounded-lg shadow"},Be={class:"font-bold mb-1 flex items-center gap-x-2 dark:text-slate-100"},Ie={class:"text-slate-600 dark:text-slate-400"},ze={class:"bg-slate-50 dark:bg-slate-700 p-4 rounded-lg shadow"},We={class:"font-bold mb-1 flex items-center gap-x-2 dark:text-slate-100"},He={class:"text-slate-600 dark:text-slate-400"},Ke={class:"bg-slate-50 dark:bg-slate-700 p-4 rounded-lg shadow"},Qe={class:"font-bold mb-1 flex items-center gap-x-2 dark:text-slate-100"},Xe={class:"text-slate-600 dark:text-slate-400"},Ye={class:"grid grid-cols-1 gap-4"},Ze={class:"bg-slate-50 dark:bg-slate-700 p-4 rounded-lg shadow"},De={class:"font-bold mb-2 flex items-center gap-x-2 dark:text-slate-100"},st={key:0},et={class:"font-semibold"},tt={key:1,class:"text-slate-600 dark:text-slate-400"},ot={class:"bg-slate-50 dark:bg-slate-700 p-4 rounded-lg shadow"},nt={class:"font-bold mb-2 flex items-center gap-x-2 dark:text-slate-100"},at={key:0},rt={class:"font-semibold"},it={key:0,class:"ml-4 list-disc list-inside"},lt={key:1,class:"text-slate-600 dark:text-slate-400"},dt={class:"bg-slate-50 dark:bg-slate-700 p-4 rounded-lg shadow"},ct={class:"font-bold mb-2 flex items-center gap-x-2 dark:text-slate-100"},ut={key:0},mt={key:1,class:"text-slate-600 dark:text-slate-400"},ft={class:"bg-slate-50 dark:bg-slate-700 p-4 rounded-lg shadow"},pt={class:"font-bold mb-2 flex items-center gap-x-2 dark:text-slate-100"},gt={key:0},_t={class:"font-semibold"},bt={key:1,class:"text-slate-600 dark:text-slate-400"},ht={class:"bg-slate-50 dark:bg-slate-700 p-4 rounded-lg shadow"},xt={class:"font-bold mb-2 flex items-center gap-x-2 dark:text-slate-100"},vt={key:0},kt={key:1,class:"text-slate-600 dark:text-slate-400"},yt={class:"bg-slate-50 dark:bg-slate-700 p-4 rounded-lg shadow"},wt={class:"font-bold mb-2 flex items-center gap-x-2 dark:text-slate-100"},$t={key:0},St={class:"font-semibold"},Ct={key:1,class:"text-slate-600 dark:text-slate-400"},Nt={class:"bg-slate-50 dark:bg-slate-700 p-4 rounded-lg shadow"},jt={class:"font-bold mb-2 flex items-center gap-x-2 dark:text-slate-100"},Vt={key:0},Et={class:"font-semibold"},Ut={key:1,class:"text-slate-600 dark:text-slate-400"},Ot={class:"bg-slate-50 dark:bg-slate-700 p-4 rounded-lg shadow"},qt={class:"font-bold mb-2 flex items-center gap-x-2 dark:text-slate-100"},Pt={class:"text-slate-600 dark:text-slate-400"},Tt={__name:"SessionDetailsView",props:{selectedSession:{type:Object,default:null},selectedCampaignName:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["startEditing"],setup(o,{emit:e}){const b=o,C=P([]),i=P([]),N=P([]),O=P([]),k=P([]),x=P([]),$=P([]),_=async v=>{if(!v){q();return}try{const{data:m,error:w}=await g.from("session_ganchos_personagens").select("*").eq("session_id",v);if(w)throw w;C.value=m;const{data:d,error:S}=await g.from("session_locais_interessantes").select(`
        *,
        caracteristicas:session_locais_caracteristicas(*)
      `).eq("session_id",v);if(S)throw S;i.value=d;const{data:A,error:J}=await g.from("session_npcs_importantes").select(`
        *,
        npcs(name)
      `).eq("session_id",v);if(J)throw J;N.value=A.map(R=>({...R,name:R.npcs.name}));const{data:F,error:G}=await g.from("session_objetivos").select("*").eq("session_id",v);if(G)throw G;O.value=F;const{data:f,error:t}=await g.from("session_segredos_rumores").select("*").eq("session_id",v);if(t)throw t;k.value=f;const{data:c,error:u}=await g.from("session_tesouros_recompensas").select("*").eq("session_id",v);if(u)throw u;x.value=c;const{data:l,error:p}=await g.from("session_encontros_desafios").select("*").eq("session_id",v);if(p)throw p;$.value=l}catch(m){console.error("Erro ao buscar detalhes da sessão:",m.message),q()}},q=()=>{C.value=[],i.value=[],N.value=[],O.value=[],k.value=[],x.value=[],$.value=[]};B(()=>b.selectedSession,v=>{v&&!b.isEditMode?_(v.id):v||q()},{immediate:!0});const h=v=>{if(!v)return"";const m={year:"numeric",month:"long",day:"numeric"};return new Date(v).toLocaleDateString("pt-BR",m)};return(v,m)=>{const w=W("font-awesome-icon");return n(),r("div",Te,[o.loading?(n(),r("div",Ae,m[0]||(m[0]=[s("p",{class:"text-lg"},"Carregando Sessões...",-1)]))):o.selectedSession?(n(),r("div",Re,[s("h3",Le,y(o.selectedSession.title),1),s("p",Je,[o.selectedSession.campaign_id?(n(),r("span",Ge,"Campanha: "+y(o.selectedCampaignName)+" • ",1)):M("",!0),L(" Criada em: "+y(h(o.selectedSession.created_at)),1)]),s("div",Me,[s("div",Fe,[s("h4",Be,[a(w,{icon:["fas","book-open"],class:"text-slate-500"}),m[1]||(m[1]=s("span",null,"Descrição",-1))]),s("p",Ie,y(o.selectedSession.description||"Nenhuma descrição."),1)]),s("div",ze,[s("h4",We,[a(w,{icon:["fas","bolt"],class:"text-slate-500"}),m[2]||(m[2]=s("span",null,"Começo Forte",-1))]),s("p",He,y(o.selectedSession.comeco_forte||"Nenhum começo forte definido"),1)]),s("div",Ke,[s("h4",Qe,[a(w,{icon:["fas","arrow-right"],class:"text-slate-500"}),m[3]||(m[3]=s("span",null,"Gancho Próxima Aventura",-1))]),s("p",Xe,y(o.selectedSession.gancho_proxima_aventura||"Nenhum gancho definido."),1)]),s("div",Ye,[m[12]||(m[12]=s("h3",{class:"text-xl font-bold text-amber-700 dark:text-amber-500 mb-3"},"Detalhes da Sessão",-1)),s("div",Ze,[s("h4",De,[a(w,{icon:["fas","user-tag"],class:"text-slate-500"}),m[4]||(m[4]=s("span",null,"Ganchos de Personagens",-1))]),C.value.length?(n(),r("ul",st,[(n(!0),r(E,null,U(C.value,d=>(n(),r("li",{key:d.id,class:"text-slate-600 dark:text-slate-400 mb-1"},[s("span",et,y(d.personagem_name||"Geral")+":",1),L(" "+y(d.description),1)]))),128))])):(n(),r("p",tt,"Nenhum gancho de personagem."))]),s("div",ot,[s("h4",nt,[a(w,{icon:["fas","map-marker-alt"],class:"text-slate-500"}),m[5]||(m[5]=s("span",null,"Locais Interessantes",-1))]),i.value.length?(n(),r("ul",at,[(n(!0),r(E,null,U(i.value,d=>(n(),r("li",{key:d.id,class:"text-slate-600 dark:text-slate-400 mb-1"},[s("span",rt,y(d.name),1),d.caracteristicas&&d.caracteristicas.length?(n(),r("ul",it,[(n(!0),r(E,null,U(d.caracteristicas,S=>(n(),r("li",{key:S.id},y(S.description),1))),128))])):M("",!0)]))),128))])):(n(),r("p",lt,"Nenhum local interessante."))]),s("div",dt,[s("h4",ct,[a(w,{icon:["fas","user-friends"],class:"text-slate-500"}),m[6]||(m[6]=s("span",null,"NPCs Importantes",-1))]),N.value.length?(n(),r("ul",ut,[(n(!0),r(E,null,U(N.value,d=>(n(),r("li",{key:d.id,class:"text-slate-600 dark:text-slate-400"},y(d.name),1))),128))])):(n(),r("p",mt,"Nenhum NPC importante."))]),s("div",ft,[s("h4",pt,[a(w,{icon:["fas","bullseye"],class:"text-slate-500"}),m[7]||(m[7]=s("span",null,"Objetivos",-1))]),O.value.length?(n(),r("ul",gt,[(n(!0),r(E,null,U(O.value,d=>(n(),r("li",{key:d.id,class:"text-slate-600 dark:text-slate-400"},[s("span",_t,y(d.type)+":",1),L(" "+y(d.description),1)]))),128))])):(n(),r("p",bt,"Nenhum objetivo."))]),s("div",ht,[s("h4",xt,[a(w,{icon:["fas","mask"],class:"text-slate-500"}),m[8]||(m[8]=s("span",null,"Segredos e Rumores",-1))]),k.value.length?(n(),r("ul",vt,[(n(!0),r(E,null,U(k.value,d=>(n(),r("li",{key:d.id,class:"text-slate-600 dark:text-slate-400"},y(d.description),1))),128))])):(n(),r("p",kt,"Nenhum segredo ou rumor."))]),s("div",yt,[s("h4",wt,[a(w,{icon:["fas","coins"],class:"text-slate-500"}),m[9]||(m[9]=s("span",null,"Tesouros e Recompensas",-1))]),x.value.length?(n(),r("ul",$t,[(n(!0),r(E,null,U(x.value,d=>(n(),r("li",{key:d.id,class:"text-slate-600 dark:text-slate-400"},[s("span",St,y(d.name)+":",1),L(" "+y(d.description_mecanica||"Sem descrição mecânica."),1)]))),128))])):(n(),r("p",Ct,"Nenhum tesouro ou recompensa."))]),s("div",Nt,[s("h4",jt,[a(w,{icon:["fas","dragon"],class:"text-slate-500"}),m[10]||(m[10]=s("span",null,"Encontros e Desafios",-1))]),$.value.length?(n(),r("ul",Vt,[(n(!0),r(E,null,U($.value,d=>(n(),r("li",{key:d.id,class:"text-slate-600 dark:text-slate-400"},[s("span",Et,y(d.title)+":",1),L(" "+y(d.description||"Sem descrição.")+" (Mecânica: "+y(d.mecanica||"N/A")+") ",1)]))),128))])):(n(),r("p",Ut,"Nenhum encontro ou desafio."))]),s("div",Ot,[s("h4",qt,[a(w,{icon:["fas","arrow-right"],class:"text-slate-500"}),m[11]||(m[11]=s("span",null,"Gancho para Próxima Aventura",-1))]),s("p",Pt,y(o.selectedSession.gancho_proxima_aventura||"Nenhum gancho definido."),1)])])])])):M("",!0)])}}},At={id:"sessoes",class:"h-full"},Rt={class:"grid grid-cols-1 md:grid-cols-3 gap-6 h-full"},Lt={class:"md:col-span-2 h-full"},Jt={__name:"SessaoAtualView",setup(o){const e=es(),b=X(),C=Y(),i=P(null),N=P(!1),O=P(null),k=P(""),x=P(""),$=d=>{e.activeSession=d,N.value=!1},_=()=>{O.value={campaign_id:i.value},N.value=!0},q=async d=>{await e.fetchLatestSessionWithDetails(d.campaign_id),O.value={...e.activeSession},N.value=!0},h=async d=>{if(confirm("Tem certeza que deseja excluir esta sessão?"))try{await e.deleteSession(d),k.value="Sessão excluída com sucesso!",x.value="success",await e.fetchSessions(i.value),e.activeSession&&e.activeSession.id===d&&(e.activeSession=null),setTimeout(()=>{k.value=""},3e3)}catch(S){k.value=`Erro ao excluir sessão: ${S.message}`,x.value="error",setTimeout(()=>{k.value=""},5e3)}},v=async d=>{try{if(d.id?(await e.updateSession(d),k.value="Sessão atualizada com sucesso!"):(await e.addSession(d),k.value="Sessão adicionada com sucesso!"),x.value="success",N.value=!1,await e.fetchSessions(i.value),e.sessions.length>0){const S=e.sessions.find(A=>A.id===d.id)||e.sessions[e.sessions.length-1];e.activeSession=S,await e.fetchLatestSessionWithDetails(e.activeSession.campaign_id)}else e.activeSession=null}catch(S){k.value=`Erro ao salvar sessão: ${S.message}`,x.value="error"}finally{setTimeout(()=>{k.value="",x.value=""},3e3)}},m=()=>{N.value=!1,O.value=null,!e.activeSession&&e.sessions.length>0&&(e.activeSession=e.sessions[0])},w=async()=>{if(!C.user){e.sessions=[],e.activeSession=null;return}await b.fetchCampaigns(C.user.id),b.campaigns.length>0?(i.value=b.campaigns[0].id,await e.fetchSessions(i.value),e.sessions.length>0?e.activeSession=e.sessions[0]:(e.activeSession=null,_())):(e.sessions=[],e.activeSession=null)};return B(i,async d=>{C.user&&(await e.fetchSessions(d),e.sessions.length>0?e.activeSession=e.sessions[0]:(e.activeSession=null,_()))}),Z(()=>{w()}),(d,S)=>(n(),r(E,null,[s("section",At,[s("div",Rt,[a(D,{entities:T(e).sessions,selectedEntity:T(e).activeSession,loading:T(e).loading,error:T(e).error,entityTitle:"Sessões",entityIcon:["fas","scroll"],showCampaignFilter:!0,campaigns:T(b).campaigns,selectedCampaignId:i.value,"onUpdate:selectedCampaignId":S[0]||(S[0]=A=>i.value=A),onSelectEntity:$,onAddEntity:_,onEditEntity:q,onDeleteEntity:h,class:"h-full overflow-y-auto"},null,8,["entities","selectedEntity","loading","error","campaigns","selectedCampaignId"]),s("div",Lt,[N.value?(n(),z(Pe,{key:1,session:O.value,campaignId:T(b).activeCampaign?.id,onSave:v,onClose:m,class:"h-full"},null,8,["session","campaignId"])):(n(),z(Tt,{key:0,selectedSession:T(e).activeSession,loading:T(e).loading,onStartEditing:S[1]||(S[1]=A=>q(T(e).activeSession)),class:"h-full"},null,8,["selectedSession","loading"]))])])]),k.value?(n(),r("div",{key:0,class:ss([{"bg-green-500":x.value==="success","bg-red-500":x.value==="error"},"text-white p-3 rounded-lg mt-4 text-center"])},y(k.value),3)):M("",!0)],64))}},Mt=Q(Jt,[["__scopeId","data-v-04fb1a2e"]]);export{Mt as default};
